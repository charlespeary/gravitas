[GLOBAL][NAME=closure]
+------------+----------------+------------------+
| Name       | Arity          |                  |
+------------+----------------+------------------+
| closure    | 0              |                  |
+------------+----------------+------------------+
| OPCODE     | CONSTANT INDEX | CONSTANT VALUE   |
+------------+----------------+------------------+
| CONSTANT_0 | 0              | upvalue::0       |
+------------+----------------+------------------+
| GET        | 1              | 3                |
+------------+----------------+------------------+
| CONSTANT_1 | 2              | 5                |
+------------+----------------+------------------+
| EQ         | 3              | upvalue::0       |
+------------+----------------+------------------+
| JIF_5      | 4              | upvalue::0       |
+------------+----------------+------------------+
| CONSTANT_2 | 5              | 1                |
+------------+----------------+------------------+
| RET        | 6              | local_address::0 |
+------------+----------------+------------------+
| NULL       | -              | -                |
+------------+----------------+------------------+
| BLC_1      | -              | -                |
+------------+----------------+------------------+
| JP_12      | -              | -                |
+------------+----------------+------------------+
| CONSTANT_3 | -              | -                |
+------------+----------------+------------------+
| CONSTANT_4 | -              | -                |
+------------+----------------+------------------+
| GET        | -              | -                |
+------------+----------------+------------------+
| CONSTANT_5 | -              | -                |
+------------+----------------+------------------+
| ADD        | -              | -                |
+------------+----------------+------------------+
| ASG        | -              | -                |
+------------+----------------+------------------+
| CONSTANT_6 | -              | -                |
+------------+----------------+------------------+
| GET        | -              | -                |
+------------+----------------+------------------+
| CALL       | -              | -                |
+------------+----------------+------------------+
| RET        | -              | -                |
+------------+----------------+------------------+
| NULL       | -              | -                |
+------------+----------------+------------------+
| BLC_1      | -              | -                |
+------------+----------------+------------------+
| NULL       | -              | -                |
+------------+----------------+------------------+
| RET        | -              | -                |
+------------+----------------+------------------+

[GLOBAL][NAME=createDoThreeTimes]
+--------------------+----------------+------------------+
| Name               | Arity          |                  |
+--------------------+----------------+------------------+
| createDoThreeTimes | 0              |                  |
+--------------------+----------------+------------------+
| OPCODE             | CONSTANT INDEX | CONSTANT VALUE   |
+--------------------+----------------+------------------+
| CONSTANT_0         | 0              | 0                |
+--------------------+----------------+------------------+
| CONSTANT_1         | 1              | global_ptr::0    |
+--------------------+----------------+------------------+
| CONSTANT_2         | 2              | local_address::1 |
+--------------------+----------------+------------------+
| CONSTANT_3         | 3              | local_address::1 |
+--------------------+----------------+------------------+
| CLOSURE_2          | 4              | local_address::2 |
+--------------------+----------------+------------------+
| CONSTANT_4         | -              | -                |
+--------------------+----------------+------------------+
| GET                | -              | -                |
+--------------------+----------------+------------------+
| RET                | -              | -                |
+--------------------+----------------+------------------+
| NULL               | -              | -                |
+--------------------+----------------+------------------+
| RET                | -              | -                |
+--------------------+----------------+------------------+

[GLOBAL][NAME=main]
+------------+----------------+------------------+
| Name       | Arity          |                  |
+------------+----------------+------------------+
| main       | 0              |                  |
+------------+----------------+------------------+
| OPCODE     | CONSTANT INDEX | CONSTANT VALUE   |
+------------+----------------+------------------+
| CONSTANT_0 | 0              | global_ptr::1    |
+------------+----------------+------------------+
| CLOSURE_0  | 1              | local_address::0 |
+------------+----------------+------------------+
| CONSTANT_1 | 2              | local_address::1 |
+------------+----------------+------------------+
| GET        | -              | -                |
+------------+----------------+------------------+
| CALL       | -              | -                |
+------------+----------------+------------------+
| CONSTANT_2 | -              | -                |
+------------+----------------+------------------+
| GET        | -              | -                |
+------------+----------------+------------------+
| CALL       | -              | -                |
+------------+----------------+------------------+

[CALL_STACK][NEW FRAME][NAME=main][RETURN_IP=0][STACK_START=0]
[VM][START OF EXECUTION][NAME=main]
[OPCODE][NEXT]: CONSTANT_0
[STACK][PUSH] global ptr: 1

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 0][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: CLOSURE_0
[STACK][POP] Some(GlobalPointer(1))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+

[STACK][PUSH] heap ptr: 1

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 1][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: CONSTANT_1
[STACK][PUSH] local_address::0

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 2][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: GET
[STACK][POP] Some(MemoryAddress(Local(0)))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+

[STACK][GET_LOCAL_VARIABLE][ADDRESS=0][VALUE=heap ptr: 1]
[STACK][PUSH] heap ptr: 1

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 3][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: CALL
[STACK][POP] Some(HeapPointer(1))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+

[VM][CALL][FUNCTION][NAME=createDoThreeTimes]
[STACK][PUSH] heap ptr: 1

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+

[CALL_STACK][NEW FRAME][NAME=createDoThreeTimes][RETURN_IP=4][STACK_START=1]
[VM] TICK
[OPCODE][NEXT]: CONSTANT_0
[STACK][PUSH] 0

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 1 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 0][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: CONSTANT_1
[STACK][PUSH] global ptr: 0

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 1 |
+-------+-------------+
| 2     | 0           |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 1][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: CONSTANT_2
[STACK][PUSH] local_address::1

+-------+---------------+
| INDEX | STACK VALUE   |
+-------+---------------+
| 0     | heap ptr: 1   |
+-------+---------------+
| 1     | heap ptr: 1   |
+-------+---------------+
| 2     | 0             |
+-------+---------------+
| 3     | global ptr: 0 |
+-------+---------------+

[VM][MOVE_POINTER][IP_NOW = 2][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: CONSTANT_3
[STACK][PUSH] local_address::1

+-------+------------------+
| INDEX | STACK VALUE      |
+-------+------------------+
| 0     | heap ptr: 1      |
+-------+------------------+
| 1     | heap ptr: 1      |
+-------+------------------+
| 2     | 0                |
+-------+------------------+
| 3     | global ptr: 0    |
+-------+------------------+
| 4     | local_address::1 |
+-------+------------------+

[VM][MOVE_POINTER][IP_NOW = 3][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: CLOSURE_2
[STACK][POP] Some(MemoryAddress(Local(1)))

+-------+------------------+
| INDEX | STACK VALUE      |
+-------+------------------+
| 0     | heap ptr: 1      |
+-------+------------------+
| 1     | heap ptr: 1      |
+-------+------------------+
| 2     | 0                |
+-------+------------------+
| 3     | global ptr: 0    |
+-------+------------------+
| 4     | local_address::1 |
+-------+------------------+

[STACK][GET_LOCAL_VARIABLE][ADDRESS=2][VALUE=0]
[STACK][POP] Some(MemoryAddress(Local(1)))

+-------+---------------+
| INDEX | STACK VALUE   |
+-------+---------------+
| 0     | heap ptr: 1   |
+-------+---------------+
| 1     | heap ptr: 1   |
+-------+---------------+
| 2     | 0             |
+-------+---------------+
| 3     | global ptr: 0 |
+-------+---------------+

[STACK][GET_LOCAL_VARIABLE][ADDRESS=2][VALUE=0]
[STACK][POP] Some(GlobalPointer(0))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 1 |
+-------+-------------+
| 2     | 0           |
+-------+-------------+

[STACK][PUSH] heap ptr: 4

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 1 |
+-------+-------------+
| 2     | 0           |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 4][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: CONSTANT_4
[STACK][PUSH] local_address::2

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 1 |
+-------+-------------+
| 2     | 0           |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 5][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: GET
[STACK][POP] Some(MemoryAddress(Local(2)))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 1 |
+-------+-------------+
| 2     | 0           |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+

[STACK][GET_LOCAL_VARIABLE][ADDRESS=3][VALUE=heap ptr: 4]
[STACK][PUSH] heap ptr: 4

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 1 |
+-------+-------------+
| 2     | 0           |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 6][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: RET
[STACK][POP] Some(HeapPointer(4))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 1 |
+-------+-------------+
| 2     | 0           |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+

[CALL_STACK][REMOVE FRAME][NAME=createDoThreeTimes][RETURN_IP=4][STACK_START=1]
[STACK][PUSH] heap ptr: 4

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 4][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: CONSTANT_2
[STACK][PUSH] local_address::1

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 5][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: GET
[STACK][POP] Some(MemoryAddress(Local(1)))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+

[STACK][GET_LOCAL_VARIABLE][ADDRESS=1][VALUE=heap ptr: 4]
[STACK][PUSH] heap ptr: 4

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 6][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: CALL
[STACK][POP] Some(HeapPointer(4))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+

[VM][CALL][FUNCTION][NAME=closure]
[STACK][PUSH] heap ptr: 4

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+

[CALL_STACK][NEW FRAME][NAME=closure][RETURN_IP=7][STACK_START=2]
[VM] TICK
[OPCODE][NEXT]: CONSTANT_0
[STACK][PUSH] upvalue::0

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 0][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: GET
[STACK][POP] Some(MemoryAddress(Upvalue { index: 0, is_ref: false }))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+

[STACK][PUSH] 0

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 1][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: CONSTANT_1
[STACK][PUSH] 3

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | 0           |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 2][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: EQ
[STACK][POP] Some(Number(3.0))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | 0           |
+-------+-------------+

[STACK][POP] Some(Number(0.0))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+

[STACK][PUSH] false

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 3][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: JIF_5
[STACK][POP] Some(Bool(false))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 4][DISTANCE = 5]
[VM][MOVE_POINTER][IP_NOW = 9][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: CONSTANT_3
[STACK][PUSH] upvalue::0

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 10][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: CONSTANT_4
[STACK][PUSH] upvalue::0

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | upvalue::0  |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 11][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: GET
[STACK][POP] Some(MemoryAddress(Upvalue { index: 0, is_ref: false }))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | upvalue::0  |
+-------+-------------+

[STACK][PUSH] 0

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | upvalue::0  |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 12][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: CONSTANT_5
[STACK][PUSH] 1

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | upvalue::0  |
+-------+-------------+
| 4     | 0           |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 13][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: ADD
[STACK][POP] Some(Number(1.0))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | upvalue::0  |
+-------+-------------+
| 4     | 0           |
+-------+-------------+

[STACK][POP] Some(Number(0.0))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | upvalue::0  |
+-------+-------------+

[STACK][PUSH] 1

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | upvalue::0  |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 14][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: ASG
[STACK][POP] Some(Number(1.0))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | upvalue::0  |
+-------+-------------+

[STACK][POP] Some(MemoryAddress(Upvalue { index: 0, is_ref: false }))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+

[STACK][ASSIGN][ADDRESS=upvalue::0][VALUE=1]
[VM][MOVE_POINTER][IP_NOW = 15][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: CONSTANT_6
[STACK][PUSH] local_address::0

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 16][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: GET
[STACK][POP] Some(MemoryAddress(Local(0)))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+

[STACK][GET_LOCAL_VARIABLE][ADDRESS=2][VALUE=heap ptr: 4]
[STACK][PUSH] heap ptr: 4

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 17][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: CALL
[STACK][POP] Some(HeapPointer(4))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+

[VM][CALL][FUNCTION][NAME=closure]
[STACK][PUSH] heap ptr: 4

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+

[CALL_STACK][NEW FRAME][NAME=closure][RETURN_IP=18][STACK_START=3]
[VM] TICK
[OPCODE][NEXT]: CONSTANT_0
[STACK][PUSH] upvalue::0

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 0][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: GET
[STACK][POP] Some(MemoryAddress(Upvalue { index: 0, is_ref: false }))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+

[STACK][PUSH] 1

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 1][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: CONSTANT_1
[STACK][PUSH] 3

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | 1           |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 2][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: EQ
[STACK][POP] Some(Number(3.0))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | 1           |
+-------+-------------+

[STACK][POP] Some(Number(1.0))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+

[STACK][PUSH] false

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 3][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: JIF_5
[STACK][POP] Some(Bool(false))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 4][DISTANCE = 5]
[VM][MOVE_POINTER][IP_NOW = 9][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: CONSTANT_3
[STACK][PUSH] upvalue::0

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 10][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: CONSTANT_4
[STACK][PUSH] upvalue::0

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | upvalue::0  |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 11][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: GET
[STACK][POP] Some(MemoryAddress(Upvalue { index: 0, is_ref: false }))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | upvalue::0  |
+-------+-------------+

[STACK][PUSH] 1

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | upvalue::0  |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 12][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: CONSTANT_5
[STACK][PUSH] 1

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | upvalue::0  |
+-------+-------------+
| 5     | 1           |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 13][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: ADD
[STACK][POP] Some(Number(1.0))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | upvalue::0  |
+-------+-------------+
| 5     | 1           |
+-------+-------------+

[STACK][POP] Some(Number(1.0))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | upvalue::0  |
+-------+-------------+

[STACK][PUSH] 2

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | upvalue::0  |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 14][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: ASG
[STACK][POP] Some(Number(2.0))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | upvalue::0  |
+-------+-------------+

[STACK][POP] Some(MemoryAddress(Upvalue { index: 0, is_ref: false }))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+

[STACK][ASSIGN][ADDRESS=upvalue::0][VALUE=2]
[VM][MOVE_POINTER][IP_NOW = 15][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: CONSTANT_6
[STACK][PUSH] local_address::0

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 16][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: GET
[STACK][POP] Some(MemoryAddress(Local(0)))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+

[STACK][GET_LOCAL_VARIABLE][ADDRESS=3][VALUE=heap ptr: 4]
[STACK][PUSH] heap ptr: 4

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 17][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: CALL
[STACK][POP] Some(HeapPointer(4))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+

[VM][CALL][FUNCTION][NAME=closure]
[STACK][PUSH] heap ptr: 4

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+

[CALL_STACK][NEW FRAME][NAME=closure][RETURN_IP=18][STACK_START=4]
[VM] TICK
[OPCODE][NEXT]: CONSTANT_0
[STACK][PUSH] upvalue::0

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 0][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: GET
[STACK][POP] Some(MemoryAddress(Upvalue { index: 0, is_ref: false }))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+

[STACK][PUSH] 2

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 1][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: CONSTANT_1
[STACK][PUSH] 3

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+
| 5     | 2           |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 2][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: EQ
[STACK][POP] Some(Number(3.0))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+
| 5     | 2           |
+-------+-------------+

[STACK][POP] Some(Number(2.0))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+

[STACK][PUSH] false

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 3][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: JIF_5
[STACK][POP] Some(Bool(false))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 4][DISTANCE = 5]
[VM][MOVE_POINTER][IP_NOW = 9][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: CONSTANT_3
[STACK][PUSH] upvalue::0

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 10][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: CONSTANT_4
[STACK][PUSH] upvalue::0

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+
| 5     | upvalue::0  |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 11][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: GET
[STACK][POP] Some(MemoryAddress(Upvalue { index: 0, is_ref: false }))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+
| 5     | upvalue::0  |
+-------+-------------+

[STACK][PUSH] 2

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+
| 5     | upvalue::0  |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 12][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: CONSTANT_5
[STACK][PUSH] 1

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+
| 5     | upvalue::0  |
+-------+-------------+
| 6     | 2           |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 13][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: ADD
[STACK][POP] Some(Number(1.0))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+
| 5     | upvalue::0  |
+-------+-------------+
| 6     | 2           |
+-------+-------------+

[STACK][POP] Some(Number(2.0))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+
| 5     | upvalue::0  |
+-------+-------------+

[STACK][PUSH] 3

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+
| 5     | upvalue::0  |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 14][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: ASG
[STACK][POP] Some(Number(3.0))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+
| 5     | upvalue::0  |
+-------+-------------+

[STACK][POP] Some(MemoryAddress(Upvalue { index: 0, is_ref: false }))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+

[STACK][ASSIGN][ADDRESS=upvalue::0][VALUE=3]
[VM][MOVE_POINTER][IP_NOW = 15][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: CONSTANT_6
[STACK][PUSH] local_address::0

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 16][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: GET
[STACK][POP] Some(MemoryAddress(Local(0)))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+

[STACK][GET_LOCAL_VARIABLE][ADDRESS=4][VALUE=heap ptr: 4]
[STACK][PUSH] heap ptr: 4

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 17][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: CALL
[STACK][POP] Some(HeapPointer(4))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+

[VM][CALL][FUNCTION][NAME=closure]
[STACK][PUSH] heap ptr: 4

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+

[CALL_STACK][NEW FRAME][NAME=closure][RETURN_IP=18][STACK_START=5]
[VM] TICK
[OPCODE][NEXT]: CONSTANT_0
[STACK][PUSH] upvalue::0

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+
| 5     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 0][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: GET
[STACK][POP] Some(MemoryAddress(Upvalue { index: 0, is_ref: false }))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+
| 5     | heap ptr: 4 |
+-------+-------------+

[STACK][PUSH] 3

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+
| 5     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 1][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: CONSTANT_1
[STACK][PUSH] 3

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+
| 5     | heap ptr: 4 |
+-------+-------------+
| 6     | 3           |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 2][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: EQ
[STACK][POP] Some(Number(3.0))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+
| 5     | heap ptr: 4 |
+-------+-------------+
| 6     | 3           |
+-------+-------------+

[STACK][POP] Some(Number(3.0))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+
| 5     | heap ptr: 4 |
+-------+-------------+

[STACK][PUSH] true

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+
| 5     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 3][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: JIF_5
[STACK][POP] Some(Bool(true))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+
| 5     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 4][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: CONSTANT_2
[STACK][PUSH] 5

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+
| 5     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 5][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: RET
[STACK][POP] Some(Number(5.0))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+
| 5     | heap ptr: 4 |
+-------+-------------+

[CALL_STACK][REMOVE FRAME][NAME=closure][RETURN_IP=18][STACK_START=5]
[STACK][PUSH] 5

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 18][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: RET
[STACK][POP] Some(Number(5.0))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+
| 4     | heap ptr: 4 |
+-------+-------------+

[CALL_STACK][REMOVE FRAME][NAME=closure][RETURN_IP=18][STACK_START=4]
[STACK][PUSH] 5

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 18][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: RET
[STACK][POP] Some(Number(5.0))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+
| 3     | heap ptr: 4 |
+-------+-------------+

[CALL_STACK][REMOVE FRAME][NAME=closure][RETURN_IP=18][STACK_START=3]
[STACK][PUSH] 5

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 18][DISTANCE = 1]
[VM] TICK
[OPCODE][NEXT]: RET
[STACK][POP] Some(Number(5.0))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+
| 2     | heap ptr: 4 |
+-------+-------------+

[CALL_STACK][REMOVE FRAME][NAME=closure][RETURN_IP=7][STACK_START=2]
[STACK][PUSH] 5

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+

[VM][MOVE_POINTER][IP_NOW = 7][DISTANCE = 1]
[VM] TICK
[VM][END OF EXECUTION]
[STACK][POP] Some(Number(5.0))

+-------+-------------+
| INDEX | STACK VALUE |
+-------+-------------+
| 0     | heap ptr: 1 |
+-------+-------------+
| 1     | heap ptr: 4 |
+-------+-------------+

[VM][EXECUTION RESULT][VALUE=Ok(Number(5.0))]
